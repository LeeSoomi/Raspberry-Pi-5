# Ctrl+Alt+T
cat > install_face_recognition_auto.sh << 'EOF'
# ì»¤ì„œ ê¹œë¹¡ì´ë©´ ì•„ë˜ ì „ì²´ ë¶™ì—¬ë„£ê¸°

------------------------------------------------

#!/bin/bash
# Face Recognition ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (ì™„ì „ ìë™)
# ë¼ì¦ˆë² ë¦¬íŒŒì´ 5 ì „ìš© (4GB/8GB ëª¨ë‘ ì§€ì›)

set -e  # ì—ëŸ¬ ë°œìƒì‹œ ì¤‘ë‹¨

echo "=========================================="
echo "Face Recognition ìë™ ì„¤ì¹˜"
echo "ë¼ì¦ˆë² ë¦¬íŒŒì´ 5 ì „ìš©"
echo "=========================================="

# ë©”ëª¨ë¦¬ í™•ì¸ í›„ ì•ˆë‚´ ë©”ì‹œì§€ ì¡°ì •
TOTAL_MEM=$(free -m | awk '/^Mem:/ {print $2}')
if [ "$TOTAL_MEM" -lt 6000 ]; then
    echo "ê°ì§€ëœ ë©”ëª¨ë¦¬: 4GB ëª¨ë¸"
    COMPILE_TIME="40-50ë¶„"
else
    echo "ê°ì§€ëœ ë©”ëª¨ë¦¬: 8GB ëª¨ë¸"
    COMPILE_TIME="30-40ë¶„"
fi

echo ""
echo "âš ï¸  ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‚¬ìš©ì í™•ì¸ ì—†ì´ ìë™ ì§„í–‰ë©ë‹ˆë‹¤"
echo "âš ï¸  ìŠ¤ì™‘ ë©”ëª¨ë¦¬ê°€ ìë™ìœ¼ë¡œ 2GBë¡œ ì„¤ì •ë©ë‹ˆë‹¤"
echo "âš ï¸  dlib ì»´íŒŒì¼ì— ${COMPILE_TIME} ì†Œìš”ë©ë‹ˆë‹¤"
echo ""
read -p "ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "ì„¤ì¹˜ ì¤‘ë‹¨"
    exit 1
fi

# ìƒ‰ê¹” ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# 1. ì‹œìŠ¤í…œ ì •ë³´ í™•ì¸
echo ""
echo "=========================================="
echo "1. ì‹œìŠ¤í…œ ì •ë³´"
echo "=========================================="

echo -n "OS ë²„ì „: "
cat /etc/os-release | grep PRETTY_NAME | cut -d'"' -f2

echo -n "Python ë²„ì „: "
python3 --version

echo -n "ë©”ëª¨ë¦¬: "
free -h | awk '/^Mem:/ {print $2}'

echo -n "CPU ì˜¨ë„: "
vcgencmd measure_temp

echo ""

# 2. CMake ìë™ ì„¤ì¹˜
echo "=========================================="
echo "2. CMake í™•ì¸ ë° ì„¤ì¹˜"
echo "=========================================="

if command -v cmake &> /dev/null; then
    CMAKE_VERSION=$(cmake --version | head -n1 | awk '{print $3}')
    echo -e "${GREEN}âœ… CMake ì„¤ì¹˜ë¨: $CMAKE_VERSION${NC}"
else
    echo "CMake ìë™ ì„¤ì¹˜ ì¤‘..."
    sudo apt update
    sudo apt install -y cmake
    CMAKE_VERSION=$(cmake --version | head -n1 | awk '{print $3}')
    echo -e "${GREEN}âœ… CMake ì„¤ì¹˜ ì™„ë£Œ: $CMAKE_VERSION${NC}"
fi

echo ""

# 3. ì˜ì¡´ì„± ìë™ ì„¤ì¹˜
echo "=========================================="
echo "3. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ìë™ ì„¤ì¹˜"
echo "=========================================="

PACKAGES=(
    "build-essential"
    "libopenblas-dev"
    "liblapack-dev"
    "libx11-dev"
    "libgtk-3-dev"
    "python3-dev"
    "python3-pip"
)

echo "í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
sudo apt update
sudo apt install -y "${PACKAGES[@]}"
echo -e "${GREEN}âœ… ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ${NC}"

echo ""

# 4. ìŠ¤ì™‘ ë©”ëª¨ë¦¬ ìë™ ì„¤ì • (4GB/8GB ê³µí†µ)
echo "=========================================="
echo "4. ìŠ¤ì™‘ ë©”ëª¨ë¦¬ ìë™ ì„¤ì •"
echo "=========================================="

SWAP_TOTAL=$(free -m | awk '/^Swap:/ {print $2}')

echo "ì „ì²´ ë©”ëª¨ë¦¬: ${TOTAL_MEM}MB"
echo "í˜„ì¬ ìŠ¤ì™‘: ${SWAP_TOTAL}MB"

if [ "$SWAP_TOTAL" -lt 2000 ]; then
    echo -e "${YELLOW}âš ï¸  ìŠ¤ì™‘ ë©”ëª¨ë¦¬ ë¶€ì¡±${NC}"
    echo "ìë™ìœ¼ë¡œ 2GBë¡œ ì¦ì„¤ ì¤‘..."
    
    sudo dphys-swapfile swapoff 2>/dev/null || true
    
    if ! command -v dphys-swapfile &> /dev/null; then
        sudo apt install -y dphys-swapfile
    fi
    
    sudo sed -i 's/CONF_SWAPSIZE=.*/CONF_SWAPSIZE=2048/' /etc/dphys-swapfile
    sudo dphys-swapfile setup
    sudo dphys-swapfile swapon
    
    SWAP_TOTAL=$(free -m | awk '/^Swap:/ {print $2}')
    echo -e "${GREEN}âœ… ìŠ¤ì™‘ ë©”ëª¨ë¦¬ ì„¤ì • ì™„ë£Œ: ${SWAP_TOTAL}MB${NC}"
else
    echo -e "${GREEN}âœ… ìŠ¤ì™‘ ë©”ëª¨ë¦¬ ì¶©ë¶„: ${SWAP_TOTAL}MB${NC}"
fi

echo ""

# 5. OpenCV ìë™ ì„¤ì¹˜
echo "=========================================="
echo "5. OpenCV í™•ì¸ ë° ì„¤ì¹˜"
echo "=========================================="

if python3 -c "import cv2" 2>/dev/null; then
    CV_VERSION=$(python3 -c "import cv2; print(cv2.__version__)")
    echo -e "${GREEN}âœ… OpenCV ì„¤ì¹˜ë¨: $CV_VERSION${NC}"
else
    echo "OpenCV ìë™ ì„¤ì¹˜ ì¤‘..."
    sudo apt install -y python3-opencv
    echo -e "${GREEN}âœ… OpenCV ì„¤ì¹˜ ì™„ë£Œ${NC}"
fi

echo ""

# 6. dlib ìë™ ì„¤ì¹˜
echo "=========================================="
echo "6. dlib ìë™ ì„¤ì¹˜ (${COMPILE_TIME} ì†Œìš”)"
echo "=========================================="

if python3 -c "import dlib" 2>/dev/null; then
    DLIB_VERSION=$(python3 -c "import dlib; print(dlib.__version__)")
    echo -e "${GREEN}âœ… dlib ì´ë¯¸ ì„¤ì¹˜ë¨: $DLIB_VERSION${NC}"
else
    echo "dlib ì»´íŒŒì¼ ì‹œì‘..."
    echo "ì‹œì‘ ì‹œê°„: $(date)"
    echo ""
    echo "ëª¨ë‹ˆí„°ë§ ë°©ë²•:"
    echo "  ìƒˆ í„°ë¯¸ë„: Ctrl+Alt+T"
    echo "  ëª…ë ¹ì–´: htop ë˜ëŠ” top"
    echo "  ì˜¨ë„: watch -n 2 vcgencmd measure_temp"
    echo ""
    
    START_TIME=$(date +%s)
    pip3 install dlib --break-system-packages
    END_TIME=$(date +%s)
    
    DURATION=$((END_TIME - START_TIME))
    MINUTES=$((DURATION / 60))
    SECONDS=$((DURATION % 60))
    
    echo ""
    echo -e "${GREEN}âœ… dlib ì„¤ì¹˜ ì™„ë£Œ${NC}"
    echo "ì†Œìš” ì‹œê°„: ${MINUTES}ë¶„ ${SECONDS}ì´ˆ"
fi

echo ""

# 7. face_recognition ìë™ ì„¤ì¹˜
echo "=========================================="
echo "7. face_recognition ìë™ ì„¤ì¹˜"
echo "=========================================="

if python3 -c "import face_recognition" 2>/dev/null; then
    echo -e "${GREEN}âœ… face_recognition ì´ë¯¸ ì„¤ì¹˜ë¨${NC}"
else
    echo "face_recognition ì„¤ì¹˜ ì¤‘..."
    pip3 install face-recognition --break-system-packages
    echo -e "${GREEN}âœ… face_recognition ì„¤ì¹˜ ì™„ë£Œ${NC}"
fi

echo ""

# 8. ì„¤ì¹˜ í™•ì¸
echo "=========================================="
echo "8. ì„¤ì¹˜ í™•ì¸ í…ŒìŠ¤íŠ¸"
echo "=========================================="

python3 << PYTHON_EOF
import sys

print("ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í…ŒìŠ¤íŠ¸:")
print("-" * 40)

try:
    import cv2
    print(f"âœ… OpenCV: {cv2.__version__}")
except ImportError as e:
    print(f"âŒ OpenCV: {e}")
    sys.exit(1)

try:
    import numpy as np
    print(f"âœ… NumPy: {np.__version__}")
except ImportError as e:
    print(f"âŒ NumPy: {e}")
    sys.exit(1)

try:
    import dlib
    print(f"âœ… dlib: {dlib.__version__}")
except ImportError as e:
    print(f"âŒ dlib: {e}")
    sys.exit(1)

try:
    import face_recognition
    print(f"âœ… face_recognition: ì„¤ì¹˜ ì™„ë£Œ")
except ImportError as e:
    print(f"âŒ face_recognition: {e}")
    sys.exit(1)

print("-" * 40)
print("ğŸ‰ ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì •ìƒ ì‘ë™!")
PYTHON_EOF

echo ""
echo "=========================================="
echo "âœ… ìë™ ì„¤ì¹˜ ì™„ë£Œ!"
echo "=========================================="
echo ""

EOF
-------------------------------------------

# 1. ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
# (ìœ„ì˜ ì „ì²´ ì½”ë“œ ë³µì‚¬)

# 2. ì‹¤í–‰ ê¶Œí•œ
chmod +x install_face_recognition_auto.sh

# 3. ì‹¤í–‰
./install_face_recognition_auto.sh

# 4. ì²˜ìŒ í•œ ë²ˆë§Œ í™•ì¸
ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): y

# 5. ì´í›„ ì™„ì „ ìë™ ì§„í–‰
# - ìŠ¤ì™‘ ìë™ ì„¤ì •
# - íŒ¨í‚¤ì§€ ìë™ ì„¤ì¹˜
# - dlib ìë™ ì»´íŒŒì¼
# - 40-50ë¶„ ëŒ€ê¸°ë§Œ í•˜ë©´ ë¨
